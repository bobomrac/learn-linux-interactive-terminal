#!/bin/bash
clear
echo "=== Network Configuration - Intermediate Level ==="
echo "This guide will teach you advanced network configuration, including advanced routing, network security, and troubleshooting techniques."
echo ""

# CHAPTER 1: ADVANCED NETWORK CONFIGURATION
echo "=== CHAPTER 1: ADVANCED NETWORK CONFIGURATION ==="
echo "Let's start by learning advanced network configuration techniques, such as configuring multiple IP addresses and setting up network bridges."
echo ""

# Step 1: Add multiple IP addresses to an interface
echo "Step 1: Add multiple IP addresses to an interface."
echo "You can assign multiple IP addresses to a single network interface. Let's add a secondary IP address to 'eth0'."
echo "Run the command: 'sudo ip addr add 192.168.1.100/24 dev eth0'."
echo ""
read -p "Write the command & press Enter: "
eval "sudo ip addr add 192.168.1.100/24 dev eth0"
echo ""
echo "A secondary IP address has been added to 'eth0'. Verify this using 'ip addr show eth0'."
echo ""
read -p "Write the command & press Enter: "
eval "ip addr show eth0"
echo ""
echo "You should see the new IP address listed under 'eth0'."
echo ""
read -p "Press Enter to continue."
echo ""

# Step 2: Remove a secondary IP address
echo "Step 2: Remove a secondary IP address."
echo "To remove the secondary IP address, use the 'ip addr del' command."
echo "Run the command: 'sudo ip addr del 192.168.1.100/24 dev eth0'."
echo ""
read -p "Write the command & press Enter: "
eval "sudo ip addr del 192.168.1.100/24 dev eth0"
echo ""
echo "The secondary IP address has been removed. Verify this using 'ip addr show eth0'."
echo ""
read -p "Write the command & press Enter: "
eval "ip addr show eth0"
echo ""
echo "The secondary IP address should no longer be listed."
echo ""
read -p "Press Enter to continue."
echo ""

# Step 3: Create a network bridge
echo "Step 3: Create a network bridge."
echo "A network bridge connects multiple network interfaces into a single network segment. Let's create a bridge named 'br0'."
echo "Run the following commands:"
echo "'sudo ip link add name br0 type bridge'"
echo "'sudo ip link set dev eth0 master br0'"
echo "'sudo ip link set dev br0 up'"
echo ""
read -p "Write the commands & press Enter: "
eval "sudo ip link add name br0 type bridge"
eval "sudo ip link set dev eth0 master br0"
eval "sudo ip link set dev br0 up"
echo ""
echo "The bridge 'br0' has been created and 'eth0' has been added to it. Verify this using 'ip link show br0'."
echo ""
read -p "Write the command & press Enter: "
eval "ip link show br0"
echo ""
echo "You should see 'br0' listed with 'eth0' as a member."
echo ""
read -p "Press Enter to continue."
echo ""

# CHAPTER 2: NETWORK SECURITY
clear
echo "=== CHAPTER 2: NETWORK SECURITY ==="
echo "Now let's learn how to secure your network using firewalls and network monitoring tools."
echo ""

# Step 4: Configure a firewall using iptables
echo "Step 4: Configure a firewall using iptables."
echo "The 'iptables' command is used to configure firewall rules. Let's block incoming traffic on port 22 (SSH)."
echo "Run the command: 'sudo iptables -A INPUT -p tcp --dport 22 -j DROP'."
echo ""
read -p "Write the command & press Enter: "
eval "sudo iptables -A INPUT -p tcp --dport 22 -j DROP"
echo ""
echo "Incoming traffic on port 22 has been blocked. Verify this using 'sudo iptables -L'."
echo ""
read -p "Write the command & press Enter: "
eval "sudo iptables -L"
echo ""
echo "You should see the rule blocking traffic on port 22."
echo ""
read -p "Press Enter to continue."
echo ""

# Step 5: Remove a firewall rule
echo "Step 5: Remove a firewall rule."
echo "To remove the rule blocking port 22, use the 'iptables -D' command."
echo "Run the command: 'sudo iptables -D INPUT -p tcp --dport 22 -j DROP'."
echo ""
read -p "Write the command & press Enter: "
eval "sudo iptables -D INPUT -p tcp --dport 22 -j DROP"
echo ""
echo "The rule blocking port 22 has been removed. Verify this using 'sudo iptables -L'."
echo ""
read -p "Write the command & press Enter: "
eval "sudo iptables -L"
echo ""
echo "The rule should no longer be listed."
echo ""
read -p "Press Enter to continue."
echo ""

# Step 6: Monitor network traffic using tcpdump
echo "Step 6: Monitor network traffic using tcpdump."
echo "The 'tcpdump' command is used to capture and analyze network traffic. Let's capture traffic on 'eth0'."
echo "Run the command: 'sudo tcpdump -i eth0'."
echo ""
read -p "Write the command & press Enter: "
eval "sudo tcpdump -i eth0"
echo ""
echo "You should see network traffic being captured in real-time. Press Ctrl+C to stop."
echo ""
read -p "Press Enter to continue."
echo ""

# CHAPTER 3: ADVANCED NETWORK TROUBLESHOOTING
clear
echo "=== CHAPTER 3: ADVANCED NETWORK TROUBLESHOOTING ==="
echo "Now let's learn advanced network troubleshooting techniques, such as analyzing network traffic and diagnosing connectivity issues."
echo ""

# Step 7: Analyze network traffic using Wireshark
echo "Step 7: Analyze network traffic using Wireshark."
echo "Wireshark is a powerful tool for analyzing network traffic. Let's capture traffic on 'eth0' and save it to a file."
echo "Run the command: 'sudo tcpdump -i eth0 -w capture.pcap'."
echo ""
read -p "Write the command & press Enter: "
eval "sudo tcpdump -i eth0 -w capture.pcap"
echo ""
echo "Network traffic is being captured and saved to 'capture.pcap'. Press Ctrl+C to stop."
echo ""
read -p "Press Enter to continue."
echo ""

# Step 8: Diagnose connectivity issues using mtr
echo "Step 8: Diagnose connectivity issues using mtr."
echo "The 'mtr' command combines the functionality of 'ping' and 'traceroute' to diagnose network issues."
echo "Run the command: 'mtr 8.8.8.8'."
echo ""
read -p "Write the command & press Enter: "
eval "mtr 8.8.8.8"
echo ""
echo "The 'mtr' command shows the path to the destination and measures packet loss and latency."
echo ""
read -p "Press Enter to continue."
echo ""

# CONCLUSION
echo "=== CONGRATULATIONS! ==="
echo "You've completed the intermediate level of network configuration!"
echo "You've learned advanced network configuration, network security, and troubleshooting techniques."
echo ""
read -p "Press Enter to return to the main menu."
show_main_menu